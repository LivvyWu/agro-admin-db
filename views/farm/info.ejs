<!DOCTYPE html>
<html>
<head>
    <% include ../head.ejs %>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
    <% include ../navigation.ejs %>
    <% include ../sidebar.ejs %>

    <div class="content-wrapper">

        <section class="content-header">
            <h1><%= farmInfo.field_name %></h1>
            <ol class="breadcrumb">
                <li><a href="/"><i class="fa fa-dashboard"></i> 首頁</a></li>
                <li><a href="/">農場</a></li>
                <li><a href="/farm">農場列表</a></li>
            </ol>
        </section>

        <div class="content row farm-info">
            <div class="box-body col-xs-12 col-sm-12">
                <div class="box box-danger">
                    <div class="box-header with-border bg-red">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
                        <h4><i class="icon fa fa-ban"></i> 警報!</h4>
                        <div class="box-tools pull-right">
                            <span data-toggle="tooltip" title="" class="badge bg-yellow"
                                  data-original-title="您有三則警示">3</span>
                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                        class="fa fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                        class="fa fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <ul class="nav nav-pills nav-stacked">
                            <li><a href="/abnormal"><i class="fa fa-exclamation-triangle"></i>溫室溫度太高，請開天窗降溫。前往處理
                                    <span class="pull-right text-red">尚未處理</span></a></li>
                            <li><a href="/abnormal"><i class="fa fa-exclamation-triangle">溫室濕度太高，請開除濕機。查看紀錄</i>
                                    <span class="pull-right text-green"></i> 已處理</span></a>
                            </li>
                            <li><a href="/abnormal"><i
                                            class="fa fa-exclamation-triangle">土壤濕度太低，請啟動灑水器。前往處理</i>
                                    <span class="pull-right text-red"></i> 尚未處理</span></a></li>
                        </ul>
                    </div>

                    <!-- /.row -->
                </div>
            </div>
            <!-- /.box-body -->

        </div>
        <div class="content row farm-info">
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab_1" data-toggle="tab">農場環控</a></li>
                    <li class=""><a href="#tab_2" data-toggle="tab">農場資料</a></li>
                </ul>


                <div class="tab-content">
                    <div class="tab-pane active" id="tab_1">
                        <!-- Small boxes (Stat box) -->
                        <div class="row">
                            <% metrics.forEach(function (metric) { %>
                            <a href="/farm/<%= farmInfo.field_id %>/datachart/<%= metric.itemCd %>"
                               class="small-box-footer">
                                <div class="col-md-3 col-xs-6 connectedSortable">
                                    <div class="small-box <%= metric.bcolor %>">
                                        <div class="inner">
                                            <h1><%= metric.val %></h1>
                                            <h4><%= metric.itemNm %></h4>
                                        </div>
                                        <div class="icon">
                                            <i class="<%= metric.icon %>"></i>
                                        </div>
                                        <div class="text-center small-box-footer">
                                            查看量測資料<i class="fa fa-arrow-circle-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <% }) %>
                        </div>
                    </div>
                    <div class="tab-pane" id="tab_2">
                        <div class="row">
                            <section class="col-md-5 connectedSortable">
                                <!-- Map box -->
                                <div class="box box-solid bg-light-blue-gradient">
                                    <div class="box-header">
                                        <i class="fa fa-map-marker"></i>
                                        <h3 class="box-title">
                                            農場位置
                                        </h3>
                                    </div>
                                    <div class="box-body">
                                        <div id="world-map" style="height: 450px; width: 100%;"></div>
                                    </div>

                                </div>
                                <!-- /.box -->
                            </section>
                            <section class="col-md-7 connectedSortable">
                                <div class="box box-solid">
                                    <div class="box-header with-border">
                                        <i class="fa fa-text-width"></i>
                                        <h3 class="box-title">農場基本資料</h3>
                                    </div>
                                    <!-- /.box-header -->
                                    <div class="box-body">
                                        <dl class="dl-horizontal">
                                            <dt>農場名稱</dt>
                                            <dd><%= farmInfo.field_name %></dd>
                                            <dt>農場地址</dt>
                                            <dd>農場地址農場地址農場地址農場地址農場地址</dd>
                                            <dt>農場所有人</dt>
                                            <dd>黃某某</dd>
                                            <dt>栽種面積</dt>
                                            <dd><%= farmInfo.field_area %></dd>
                                            <dt>田地種類</dt>
                                            <dd><%= farmInfo.field_area %></dd>
                                            <dt>使用狀態</dt>
                                            <dd>使用中</dd>
                                            <dt>栽種作物</dt>
                                            <dd><%= farmInfo.field_area %></dd>
                                            <dt>建立時間</dt>
                                            <dd>1981/10/29</dd>
                                        </dl>
                                    </div>
                                    <!-- /.box-body -->

                                    <div class="box-header with-border">
                                        <i class="fa fa-text-width"></i>
                                        <h3 class="box-title">農場地籍資料</h3>
                                    </div>
                                    <!-- /.box-header -->
                                    <div class="box-body">
                                        <dl class="dl-horizontal">
                                            <dt>地籍地號(母)</dt>
                                            <dd></dd>
                                            <dt>地籍地號(子)</dt>
                                            <dd></dd>
                                            <dt>地址-省</dt>
                                            <dd><%= field_location.fel_country %></dd>
                                            <dt>地址-縣市</dt>
                                            <dd><%= field_location.fel_city %></dd>
                                            <dt>地址-鄉鎮區</dt>
                                            <dd><%= field_location.fel_zone %></dd>
                                            <dt>地址-段</dt>
                                            <dd><%= field_location.fel_seg %></dd>
                                            <dt>地址-小段</dt>
                                            <dd></dd>
                                            <dt>地號面積(公頃)</dt>
                                            <dd><%= field_location.fel_area %></dd>
                                            <dt>農地流水號</dt>
                                            <dd></dd>
                                            <dt>農地經緯度</dt>
                                            <dd></dd>
                                            <dt>使用狀態</dt>
                                            <dd></dd>
                                            <dt>建立日期</dt>
                                            <dd><%= field_location.created_date %></dd>
                                        </dl>
                                    </div>
                                    <!-- /.box-body -->
                                </div>
                                <!-- /.box -->
                            </section>
                        </div>


                        <div class="nav-tabs-custom">
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#tab_4" data-toggle="tab">感測器列表</a></li>
                                <li class=""><a href="#tab_activity" data-toggle="tab">田間作業計畫</a></li>
                            </ul>
                            <div class="tab-content">

                                <div class="tab-pane active" id="tab_4">
                                    <div class="box">
                                        <!-- /.box-header -->
                                        <div class="box-body">
                                            <table id="example2"
                                                   class="display table table-bordered table-striped">
                                                <thead>
                                                <tr>
                                                    <th>類型</th>
                                                    <th>感測器名稱</th>
                                                    <th>目前感測數值</th>
                                                    <th>狀態</th>
                                                    <th>感測資料</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <% sensors.forEach(function (s) { %>

                                                <tr>
                                                    <td>溫度計</td>
                                                    <td><%= s.sensor_name %></td>
                                                    <td>25</td>
                                                    <td>ON</td>
                                                    <td>
                                                        <a href="/farm/<%= farmInfo.field_id %>/datachart/InAirTem">前往觀看</a>
                                                    </td>
                                                </tr>
                                                <% }) %>
                                                </tbody>
                                            </table>
                                        </div>
                                        <!-- /.box-body -->
                                    </div>
                                    <!-- /.box -->

                                </div>
                                <div class="tab-pane" id="tab_activity">
                                    <div class="box">

                                        <!-- /.box-header -->
                                        <div class="box-body">
                                            <table id="example1"
                                                   class="display table table-bordered table-striped">
                                                <thead>
                                                <tr>
                                                    <th>項目</th>
                                                    <th>日期</th>
                                                    <th>工作內容</th>
                                                    <th>開始日期</th>
                                                    <th>完成日期</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 4.0
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td> 4</td>
                                                    <td>X</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 5.0
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td>5</td>
                                                    <td>C</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 5.5
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td>5.5</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 6
                                                    </td>
                                                    <td>Win 98+</td>
                                                    <td>6</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet Explorer 7</td>
                                                    <td>Win XP SP2+</td>
                                                    <td>7</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 4.0
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td> 4</td>
                                                    <td>X</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 5.0
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td>5</td>
                                                    <td>C</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 5.5
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td>5.5</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 6
                                                    </td>
                                                    <td>Win 98+</td>
                                                    <td>6</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet Explorer 7</td>
                                                    <td>Win XP SP2+</td>
                                                    <td>7</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 4.0
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td> 4</td>
                                                    <td>X</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 5.0
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td>5</td>
                                                    <td>C</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 5.5
                                                    </td>
                                                    <td>Win 95+</td>
                                                    <td>5.5</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet
                                                        Explorer 6
                                                    </td>
                                                    <td>Win 98+</td>
                                                    <td>6</td>
                                                    <td>A</td>
                                                </tr>
                                                <tr>
                                                    <td>Trident</td>
                                                    <td>Internet Explorer 7</td>
                                                    <td>Win XP SP2+</td>
                                                    <td>7</td>
                                                    <td>A</td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                        <!-- /.box-body -->
                                    </div>
                                    <!-- /.box -->
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- callout -->
            <div class="callout callout-info">
                <h4>查看農場環控歷史統計資料 <a href="/farm/sensorRecord">前往<i class="fa fa-arrow-circle-right"></i></a>
                </h4>
            </div>
            <!-- /.callout -->
            <div class="box-body cwb2">
                <div class="box">
                    <div class="box-header with-border">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>

                        <p>
                            南投縣 埔里鎮
                        </p>

                        <div class="box-tools pull-right">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                        class="fa fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                        class="fa fa-times"></i>
                            </button>
                        </div>

                        <div class="">
                            2016-12-06 15:00
                        </div>
                        <div class="col-xs-12 current">
                            <div class="">
                                <i class="weather wi wi-day-sunny wi-3x m-r-1"></i>
                            </div>
                            <div class="">
                                <p><i class="wi wi-thermometer wi-1x m-r-1"></i>
                                    20°C
                                </p>
                                <p><i class="wi wi-humidity wi-1x m-r-1"></i>
                                    88%
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="box-body forecast">
                        <div class="col-xs-4 col-sm-2 text-center">
                            <div class="inner">
                                <p>星期二</p>
                                <i class="wi wi-day-cloudy wi-1x"></i>
                                <p>25°-30°</p>
                                <p><i class="wi wi-umbrella wi-s"></i>78%</p>
                            </div>
                        </div>
                        <div class="col-xs-4 col-sm-2 text-center">
                            <div class="inner">
                                <p>星期三</p>
                                <i class="wi wi-cloud wi-1x"></i>
                                <p>25°-30°</p>
                                <p><i class="wi wi-umbrella wi-1x"></i>78%</p>
                            </div>
                        </div>
                        <div class="col-xs-4 col-sm-2 text-center">
                            <div class="inner">
                                <p>星期四</p>
                                <i class="wi wi-hail wi-1x"></i>
                                <p>25°-30°</p>
                                <p><i class="wi wi-umbrella wi-s"></i>78%</p>
                            </div>
                        </div>
                        <div class="col-xs-4 col-sm-2 text-center">
                            <div class="inner">
                                <p>星期五</p>
                                <i class="wi wi-cloud wi-1x"></i>
                                <p>25°-30°</p>
                                <p><i class="wi wi-umbrella wi-s"></i>78%</p>
                            </div>
                        </div>
                        <div class="col-xs-4 col-sm-2 text-center">
                            <div class="inner">
                                <p>星期六</p>
                                <i class="wi wi-day-sunny wi-1x"></i>
                                <p>25°-30°</p>
                                <p><i class="wi wi-umbrella wi-s"></i>78%</p>
                            </div>
                        </div>
                        <div class="col-xs-4 col-sm-2 text-center">
                            <div class="inner">
                                <p>星期日</p>
                                <i class="wi wi-day-cloudy wi-1x"></i>
                                <p>25°-30°</p>
                                <p><i class="wi wi-umbrella wi-s"></i>78%</p>
                            </div>
                        </div>
                    </div>
                    <div id="chart"></div>
                </div>
            </div>

        </div>
    </div>

    <% include ../includejs1.ejs %>
    <script src="/js/mapUtil.js"></script>
    <!-- page script -->
    <script>

        MapUtil.initJson = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            [
                                [
                                    120.47331690788269,
                                    24.065200804965205
                                ],
                                [
                                    120.4731559753418,
                                    24.06489711908188
                                ],
                                [
                                    120.47298967838287,
                                    24.064294643347
                                ],
                                [
                                    120.47305941581727,
                                    24.06396646431742
                                ],
                                [
                                    120.47300577163695,
                                    24.063412966440392
                                ],
                                [
                                    120.47329545021056,
                                    24.063138665722672
                                ],
                                [
                                    120.4737138748169,
                                    24.06300151514391
                                ],
                                [
                                    120.47384798526762,
                                    24.063050497510293
                                ],
                                [
                                    120.47392845153807,
                                    24.06332969664165
                                ],
                                [
                                    120.47418594360353,
                                    24.06401054811647
                                ],
                                [
                                    120.47439515590668,
                                    24.064235865075055
                                ],
                                [
                                    120.47442197799681,
                                    24.064466079819702
                                ],
                                [
                                    120.47452390193939,
                                    24.064764868553162
                                ],
                                [
                                    120.47426104545592,
                                    24.064911813576646
                                ],
                                [
                                    120.47405719757079,
                                    24.065019573153577
                                ],
                                [
                                    120.47367095947266,
                                    24.065088147382678
                                ],
                                [
                                    120.47331690788269,
                                    24.065200804965205
                                ]
                            ]
                        ]
                    }
                }
            ]
        };

        //Make the dashboard widgets sortable Using jquery UI
        $(".connectedSortable").sortable({
            placeholder: "sort-highlight",
            connectWith: ".connectedSortable",
            handle: ".box-header, .nav-tabs",
            forcePlaceholderSize: true,
            zIndex: 999999
        });
        $(".connectedSortable .box-header, .connectedSortable .nav-tabs-custom").css("cursor", "move");

        $(function () {
            $('#example1, #example2').DataTable({
                "paging": true,
                "pagingType": "full_numbers",
                "lengthChange": true,
                "searching": false,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "oLanguage": {
                    "sLengthMenu": "顯示 _MENU_ 筆記錄",
                    "sZeroRecords": "無符合資料",
                    "sInfo": "目前記錄：_START_ 至 _END_, 總筆數：_TOTAL_",
                }
            });

            //$('#example1').removeClass( 'display' ).addClass('table table-striped table-bordered');
            $('.sidebar-toggle').on('click', function () {
                console.log('click');
                $('.cwb').toggleClass('hide');
            })

            ///////////////////////////////////////////////////
/////////////// Create the data ///////////////////
///////////////////////////////////////////////////

//Completely random dataset
            var dataset = [
                {date: "2017-01-01 06:00:00", number: 23},
                {date: "2017-01-01 18:00:00", number: 24},
                {date: "2017-01-02 06:00:00", number: 25},
                {date: "2017-01-02 18:00:00", number: 26},
                {date: "2017-01-03 06:00:00", number: 27},
                {date: "2017-01-03 18:00:00", number: 28},
                {date: "2017-01-04 06:00:00", number: 27},
                {date: "2017-01-04 18:00:00", number: 26},
                {date: "2017-01-05 06:00:00", number: 27},
                {date: "2017-01-05 18:00:00", number: 25},
                {date: "2017-01-06 06:00:00", number: 22},
                {date: "2017-01-06 18:00:00", number: 26},
                {date: "2017-01-07 06:00:00", number: 19},
                {date: "2017-01-07 18:00:00", number: 20}
            ]
//Parse the date
            var parseDate = d3.timeParse("%Y-%m-%d %H:%M:%S");
            dataset.forEach(function (d) {
                d.date = parseDate(d.date);
            });
///////////////////////////////////////////////////
//////////////// Set the Scales ///////////////////
///////////////////////////////////////////////////
//Set the dimensions of the chart
            var margin = {top: 30, right: 30, bottom: 30, left: 50},
                width = 900 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;
//Set the x and y scale ranges
            var xScale = d3.scaleTime()
                .domain(d3.extent(dataset, function (d) {
                    return d.date;
                }))
                .range([0, width]);

            var yScale = d3.scaleLinear()
                .domain(d3.extent(dataset, function (d) {
                    return d.number;
                }))
                .range([height, 10]);
//Define the axes
            var xAxis = d3.axisBottom(xScale);
//            var yAxis = d3.svg.axis()
//                .scale(yScale)
//                .orient("left")
//                .ticks(5);

//Initiate the line function
            var lineFunction = d3.line()
                .x(function (d) {
                    return xScale(d.date);
                })
                .y(function (d) {
                    return yScale(d.number);
                });
//Initiate the area line function
            var areaFunction = d3.area()
                .x(function (d) {
                    return xScale(d.date);
                })
                .y0(height)
                .y1(function (d) {
                    return yScale(d.number);
                });
///////////////////////////////////////////////////
////////////// Initialize the SVG /////////////////
///////////////////////////////////////////////////

//Add the svg canvas for the line chart
            var svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
///////////////////////////////////////////////////
///////////// Create the gradient /////////////////
///////////////////////////////////////////////////

//Define the gradient below the line chart
            var areaGradient = svg.append('defs')
                .append("linearGradient")
                .attr('id', 'areaGradient')
                .attr("x1", "0%").attr("y1", "0%")
                .attr("x2", "0%").attr("y2", "100%");

//Append the first stop - the color at the top
            areaGradient.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", "#FF3757")
                .attr("stop-opacity", 0.6);
//Append the second stop - white transparant almost at the end
            areaGradient.append("stop")
                .attr("offset", "80%")
                .attr("stop-color", "white")
                .attr("stop-opacity", 0);
///////////////////////////////////////////////////
/////////////// Create the chart //////////////////
///////////////////////////////////////////////////

//Add the X Axis
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);
//Add the Y Axis
            svg.append("g")
                .attr("class", "y axis")
                .call(d3.axisLeft(yScale));
//Draw the underlying area chart filled with the gradient
            svg.append("path")
                .attr("class", "area")
                .style("fill", "url(#areaGradient)")
                .attr("d", areaFunction(dataset));
//Draw the line
            svg.append("path")
                .attr("class", "line")
                .attr("d", lineFunction(dataset));

            svg.selectAll(".lineDots")
                .data(dataset, function (d) {
                    return d.date;
                })
                .enter().append("circle")
                .attr("class", "lineDots")
                .attr("r", 3)
                .attr("cx", function (d) {
                    return xScale(d.date);
                })
                .attr("cy", function (d) {
                    return yScale(d.number);
                });


        });


    </script>
</body>
</html>
